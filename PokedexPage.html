<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script src="//code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css">
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
    <script>
        var iosocket = io.connect('http://localhost:3000');
        var availableTags;


        $(function(){
            $('#pokemonSelector').keydown(function(event) {
                if (event.keyCode == 13) {
                    getPokeInfo();
                }
            })
        });

        function getSite(theData){
            console.log(theData)
        }

        function dispPoke(){
            iosocket.emit('doDatabaseStuff');
        }

        function getPokeInfo(){
            console.log('in pokeinfo' + " " + $('#pokemonSelector').val());
            $('#theContents').text($('#pokemonSelector').val())
            iosocket.emit('getPicture', $('#pokemonSelector').val())
        }

        iosocket.on('updateDropDown', function(pokemon){
            availableTags = pokemon;
            console.log(pokemon);
            $("#pokemonSelector").autocomplete({source: availableTags, messages: {
                noResults: '',
                results: function() {}
            }});
            getPokeInfo();
        });

        iosocket.on('setPicture', function(imgUrl, dexDat){
            console.log('in setpic')
            console.log(dexDat)
            if(dexDat != null){
                console.log('in1')
                $('#curPokemon').fadeIn();
                $('#curPokemon').html('<img src="' + imgUrl + '">')
                $('#curDescription').html('<h3>' + dexDat + '</h3>')
            } else {
                console.log('in2')
                $('#curPokemon').hide();
                $('#curDescription').html('Please enter a pokemon to see its description.');
            }
        });

    </script>
</head>
<body class="container">

<div class="row-fluid">
    <div id="navAndHeader"></div>
    <script type="text/javascript">
        $(function() {
            $("#navAndHeader").load("/template"); // add "/"
        });
    </script>
    <!--<input type="button" class='btn btn-default btn-success' onclick="dispPoke()" value="do stuff">-->
    <div>
        <input type='text' id='pokemonSelector' class="ui-autocomplete"/>
        <button onClick="getPokeInfo()">Enter</button>
    </div>
    <div class="col-md-4 col-mid-offset-4"></div>
    <h2 id="theContents"></h2>
    <div id="curPokemon" class="col-md-6 col-md-offset-3"></div><br>
    <div id="curDescription" class="col-md-12"></div>
</div>
</body>
</html>